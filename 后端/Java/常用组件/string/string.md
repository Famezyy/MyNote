## StringBuilderã€StringBufferã€StringJoiner

| ç±»å‹          | ç‰¹ç‚¹                                                         | ä½¿ç”¨åœºæ™¯                           |
| ------------- | ------------------------------------------------------------ | ---------------------------------- |
| String        | value å€¼ç”±`final`ä¿®é¥°ï¼Œä¸å¯å˜ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ¯æ¬¡ä¿®æ”¹äº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œæ€§èƒ½æœ€å·® | æ“ä½œå°‘é‡æ•°æ®æˆ–ä¸éœ€è¦æ“ä½œæ•°æ®       |
| StringBuilder | å¯å˜ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ¯æ¬¡ä¿®æ”¹ä¸äº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œæ€§èƒ½æœ€é«˜           | éœ€è¦é¢‘ç¹æ“ä½œæ•°æ®ä¸”ä¸ç”¨è€ƒè™‘çº¿ç¨‹å®‰å…¨ |
| StringBuffer  | å¯å˜ï¼Œçº¿ç¨‹å®‰å…¨ï¼ˆæ·»åŠ äº†Synchronizeå…³é”®å­—ï¼‰ï¼Œæ¯æ¬¡ä¿®æ”¹ä¸äº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œæ€§èƒ½è¾ƒå·® | éœ€è¦é¢‘ç¹æ“ä½œæ•°æ®ä¸”éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ |

- `StringBuilder`é€‚åˆ**å¤§é‡å­—ç¬¦ä¸²çš„æ‹¼æ¥**ï¼Œä¸é€‚ç”¨äº==å°‘é‡å­—ç¬¦ä¸²æ‹¼æ¥==å’Œ==å¾ªç¯ä½“å†…ä½¿ç”¨==ï¼Œåè€…æ¨èç›´æ¥ä½¿ç”¨`+`

- `concat`æ–¹æ³•åº•å±‚ä½¿ç”¨äº†`System.ArrayCopy()`æ–¹æ³•ï¼Œé€‚ç”¨äº**å¤§é‡çš„å­—ç¬¦ä¸²æ‹¼æ¥**ï¼Œä½†ä¸é€‚ç”¨==å°‘é‡å­—ç¬¦ä¸²çš„æ‹¼æ¥==

- `StringJoiner`ç”¨äºå­—ç¬¦ä¸²åˆ†éš”ç¬¦æ‹¼æ¥

  ```java
  String[] names = {"A", "B", "C", "D"};
  StringJoiner sj = new StringJoiner(",", "[", "]");
  for (String name : names) {
      sj.add(name);
  }
  System.out.println(sj); // [A,B,C,D]
  ```

## Stringåº•å±‚æ•°ç»„ç»“æ„

åœ¨`JAVA8`åŠä»¥å‰æ˜¯`charæ•°ç»„`ï¼Œå› ä¸ºè‹±æ–‡åªå ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨`charæ•°ç»„`å¤ªæµªè´¹ç©ºé—´äº†ï¼Œæ‰€ä»¥`JAVA9`ä¹‹åæ”¹ä¸º`byteæ•°ç»„`ã€‚

> `char`å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼ˆUTF-16ï¼‰ï¼Œ`byte`å ç”¨ä¸€ä¸ªå­—èŠ‚

ä¸ºäº†å…¼å®¹è‹±æ–‡ä¹‹å¤–çš„å…¶ä»–è¯­è¨€ï¼Œ`JAVA9`è¿˜æ–°å¢äº†ä¸€ä¸ª`code`å­—æ®µï¼Œç”¨æ¥æè¿°ä½¿ç”¨å“ªç§ç¼–ç æ ¼å¼ã€‚

```java
/**
 * The supported values in this implementation are
 *
 * LATIN1
 * UTF16
 */
private final byte coder;

static final byte LATIN1 = 0;
static final byte UTF16 = 1;
```

æ±‚å­—ç¬¦ä¸²é•¿åº¦çš„ä»£ç ä¹Ÿå‘ç”Ÿäº†æ”¹å˜ï¼š

```java
public int length() {
    /**
     * ä½¿ç”¨ LATIN å­—ç¬¦æ—¶ï¼Œä¸€ä¸ªå­—èŠ‚å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥é•¿åº¦ç­‰äºå­—èŠ‚é•¿åº¦
     * ä½¿ç”¨ UTF16 æ—¶ï¼Œä¸¤ä¸ªå­—èŠ‚å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥é•¿åº¦ä¸ºå­—èŠ‚é•¿åº¦ä¸€åŠï¼Œä½¿ç”¨å¸¦ç¬¦å·ä½è¿ç®— >> 1
     *
     */
    return value.length >> coder();
}
```

ä½¿ç”¨`UTF-16`æ—¶ï¼Œç”±äºä¸¤ä¸ªå­—èŠ‚æœ€å¤šå­˜å‚¨ 6 ä¸‡å¤šä¸ªå­—ç¬¦ï¼Œå¯¹äºå…¶ä»–å­—ç¬¦ï¼Œè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ

å…¶å®`UTF-16`çš„ä¸¤ä¸ªå­—èŠ‚ç§°ä¸ºä¸€ä¸ª`ä»£ç å•å…ƒ`ï¼ŒåŸºæœ¬å­—ç¬¦é€šå¸¸ç”±`ä¸€ä¸ªä»£ç `å•å…ƒç»„æˆï¼Œå¯¹äºéœ€è¦ç”¨ä¸¤ä¸ªä»¥ä¸Šå­—èŠ‚è¡¨ç¤ºçš„å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨`è¾…åŠ©å­—ç¬¦`æ¥è¡¨ç¤ºï¼Œè¯¥å­—ç¬¦ç”¨`ä¸¤ä¸ªä»£ç å•å…ƒ`æ„æˆã€‚

> åŸºæœ¬å­—ç¬¦ï¼šU+0000 ~ U+FFFF
>
> è¾…åŠ©å­—ç¬¦ï¼šU+100000 ~ U+10FFFF

å½“è·å–å­—ç¬¦é•¿åº¦æ—¶ï¼Œå¦‚æœå­˜åœ¨è¾…åŠ©å­—ç¬¦ï¼Œåˆ™ä½¿ç”¨`length()`æ–¹æ³•è·å–ä¸åˆ°å®é™…é•¿åº¦ï¼š

```java
String s1 = "zhao";
String s2 = "zhaoğŸ˜Š";

System.out.println(s1.length()); // 4
System.out.println(s2.length()); // 6
System.out.println(s2.charAt(4)); // ?
System.out.println(s2.charAt(5)); // ?
```

å› ä¸º`length()`çš„ä½œç”¨æ˜¯è·å–`ä»£ç å•å…ƒ`çš„æ•°é‡ï¼Œè€Œè¾…åŠ©å­—ç¬¦éœ€è¦ä¸¤ä¸ªä»£ç å•å…ƒã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨`ç ç‚¹`çš„æ–¹å¼æ¥è·å–ï¼š

> å­—ç¬¦åº•å±‚éƒ½æ˜¯ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºçš„ï¼Œä¸€ä¸ªäºŒè¿›åˆ¶å¯¹åº”ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶å°±æ˜¯ç ç‚¹

```java
String s1 = "zhao";
String s2 = "zhaoğŸ˜Š";

System.out.println(s1.codePointCount(0, s1.length())); // 4
System.out.println(s2.codePointCount(0, s2.length())); // 5
```

åˆ¤æ–­`è¾…åŠ©å­—ç¬¦`çš„æ–¹æ³•ï¼š

```java
String s1 = "zhao";
String s2 = "zhaoğŸ˜Š";

/// 1.æŸ¥çœ‹ç ç‚¹æ˜¯å¦æ˜¯è¾…åŠ©å­—ç¬¦
// è·å–ç ç‚¹
System.out.println(Arrays.toString(s1.codePoints().toArray())); // [122, 104, 97, 111]
System.out.println(Arrays.toString(s2.codePoints().toArray())); // [122, 104, 97, 111, 128522]

// åˆ¤æ–­ç ç‚¹æ˜¯å¦æ˜¯è¾…åŠ©å­—ç¬¦
System.out.println(Character.isSupplementaryCodePoint(122)); // false
System.out.println(Character.isSupplementaryCodePoint(128522)); // true

/// 2.æŸ¥çœ‹charæ˜¯å¦æ˜¯è¾…åŠ©å­—ç¬¦
System.out.println(Character.isSurrogate(s2.charAt(3))); // false
System.out.println(Character.isSurrogate(s2.charAt(4))); // true
System.out.println(Character.isSurrogate(s2.charAt(5))); // true
```

##  æœ€å¤§é•¿åº¦

åœ¨**ç¼–è¯‘æœŸ**ï¼Œjava ç¼–è¯‘å™¨è¦æ±‚å­—ç¬¦ä¸²å­—é¢é‡çš„é•¿åº¦å°äº`Poll.MAX_STRING_LENGTH = 2^16-1 = 65535`ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§`65534`ã€‚

åœ¨**è¿è¡ŒæœŸ**ï¼Œå­—ç¬¦ä¸²æ˜¯ä»¥`char[]`å½¢å¼å­˜åœ¨ï¼Œè€Œæ•°ç»„é•¿åº¦æ˜¯ int ç±»å‹ï¼Œ`Integer.MAX_VALUE = 2^31-1 = 2147483647`ï¼Œçº¦ä¸º 21 äº¿ï¼Œä¸€ä¸ª char å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œå…±éœ€è¦å¤§çº¦ 4G å­˜å‚¨ç©ºé—´ã€‚
