# 第3章_bash shell基础命令

很多 Linux 发行版的默认 shell 是 GNU bash shell。本章将介绍 bash shell 的基本特性，比如 bash 手册、命令行补全以及如何显示文件内容。我们会带你逐步了解怎样用 bash shell 提供的基础命令来处理 Linux 文件和目录。

## 1.启动 shell

GNU bash shell 是一个程序，提供了对 Linux 系统的交互式访问。它是作为普通程序运行的，通常是在用户登录终端时启动。系统启动的 shell 程序取决于用户账户的配置。

`/etc/passwd`文件包含了所有系统用户账户以及每个用户的基本配置信息。下面是从 /etc/passwd 文件中摘取的样例条目：

```bash
christine:x:1001:1001::/home/christine:/bin/bash
```

每个条目包含 7 个数据字段，字段之间用冒号分隔。系统使用字段中的数据来赋予用户账户某些特性。第 7 章会对其中多数条目进行更加详细的讨论。现在先将注意力放在最后一个字段上，**该字段指定了用户使用的 shell 程序**。

> **注意**
>
> 尽管本书侧重于 GNU bash shell，但是也会谈及其他 shell。第 23 章将介绍如何使用这些 shell，比如 dash 和 tcsh。

在先前的 /etc/passwd 样例条目中，用户 christine 将 /bin/bash 作为自己的默认 shell 程序。这意味着在 christine 登录 Linux 系统后，GNU bash shell 会自行启动。

尽管 bash shell 会在登录时自行启动，但是否会出现 shell 命令行界面（CLI）取决于所使用的登录方式。如果采用的是虚拟控制台终端登录，那么 CLI 提示符会自动出现，接受 shell 命令输入。但如果是通过图形化桌面环境登录 Linux 系统，则需要启动图形化终端仿真器来访问 shell CLI 提示符。

## 2.使用shell提示符

启动终端仿真器包或登录 Linux 虚拟控制台之后会看到 shell CLI **提示符**。提示符是进入 shell 世界的大门，你可以在此输入 shell 命令。

默认的 bash shell 提示符是美元符号（`$`），这个符号表明 shell 在等待用户输入命令。不同的 Linux 发行版会采用不同格式的提示符。Ubuntu Linux 系统的 shell 提示符是这样的：

```bash
christine@UDesktop:~$
```

CentOS Linux系统的shell提示符是这样的：

```bash
[christine@localhost ~]$
```

除了作为 shell 的入口，提示符还能提供额外的辅助信息。在上面的两个例子中，提示符中显示了当前用户名 christine。除此之外，还包括 Ubuntu 系统的主机名 UDesktop 以及 CentOS 系统的主机名 localhost。随后在本章中你会学到更多可以在提示符中显示的内容。

> **提示**
>
> 如果刚接触 CLI，那么请记住，在提示符处入 shell 命令之后，还得按 Enter 键才能让命令生效。

shell 提示符并非一成不变。你可以根据需要修改提示符，第 6 章将讲解如何配置 shell CLI 提示符。

可以把 shell CLI 提示符想象成一位贴心的“助手”，它会帮助你使用 Linux 系统，给你有益的提示，告诉你什么时候 shell 可以接受新的命令。除此了解 shell 提示符，我们还可以参考 bash 手册。

## 3.与bash手册交互

大多数 Linux 发行版自带在线手册，可用于查找 shell 命令以及其他 GNU 实用工具的相关信息。熟悉手册对于使用各种 Linux 工具大有裨益，尤其是当你想要弄清各种命令行参数的时候。

`man`命令可以访问 Linux 系统的手册页。在`man`命令之后跟上想要查看的命令名，就可以显示相应的手册页。图 3-1 展示了如何查找`hostname`命令的手册页。输入命令`man hostname`即可进入该页面。

**图3-1　`hostname`命令的手册页**

<img src="img/019.jpg" alt="{%}" style="zoom:80%;" />

注意图 3-1 中`hostname`命令的`DESCRIPTION`一节。这部分内容松散，字里行间充满了技术术语。bash 手册并不是按部就班的学习指南，而是作为快速参考来使用的。

> **提示**
>
> 如果你刚接触 bash shell，可能会觉得手册页也没那么有用。然而，随着逐渐习惯使用手册页，尤其是阅读`DESCRIPTION`部分的前一两段，最终你会从中学到各种技术术语，手册页也会变得越来越有用。

当你使用`man`命令查看命令手册页的时候，其中的信息是由**分页程序**（pager）来显示的。分页程序是一种实用工具，能够逐页（或逐行）显示文本。你可以点击`空格键`进行翻页，或是使用`Enter`键逐行查看。也可以使用箭头键向前和向后滚动手册页的内容（假设你使用的终端仿真软件包支持箭头键功能）。

如果阅读完毕，可以按 q 键退出手册页，然后你会重新获得 shell CLI 提示符，表明 shell 正在等待接受下一个命令。

> **提示**
>
> bas手册甚至包含了一份有关自身的参考信息。输入`man man`可以查看与手册页相关的信息。
>
> ```bash
> DESCRIPTION
>        man is the system's manual pager. Each page argument given to man is normally the name of a program, utility or function. 
> ```

手册页将与命令相关的信息分成了多段。每一段的惯用名标准如表 3-1 所示。

**表3-1　Linux手册页惯用的段名**

|      段       |            描述            |
| :-----------: | :------------------------: |
|     Name      | 显示命令名和一段简短的描述 |
|   Synopsis    |          命令语法          |
| Configuration |        命令配置信息        |
|  Description  |      命令的一般性描述      |
|    Options    |        命令选项描述        |
|  Exit Status  |       命令的退出状态       |
| Return Value  |        命令的返回值        |
|    Errors     |       命令的错误消息       |
|  Environment  |     命令使用的环境变量     |
|     Files     |       命令用到的文件       |
|   Versions    |       命令的版本信息       |
| Conforming To |       遵循的命名标准       |
|     Notes     |      其他有帮助的资料      |
|     Bugs      |      提交 bug 的途径       |
|    Example    |        命令用法示例        |
|    Authors    |     命令开发人员的信息     |
|   Copyright   |    命令源代码的版权状况    |
|   See Also    |   与该命令类似的其他命令   |

并不是每一个命令的手册页都包含表中列出的所有段名。另外，有些命令使用的段名并没有在上面的惯用标准中列出。

在命令概要部分中，你可以了解如何在命令行中输入该命令。很多命令采用的基本模式如下。

```bash
COMMAND-NAME [OPTION]... [ARGUMENT]...
```

下面是对以上命令的模式结构的解释。

- `*COMMAND-NAME*` 是要运行的命令名
- `[*OPTION*]` 是用于修改命令行为的选项。可添加的 `*OPTION*`（也称作**开关**）通常不止一个。中括号（`[]`）表示 `*OPTION*` 并不是必需的，3 个点号（`...`）表示可以一次指定多个 `*OPTION*`
- `*ARGUMENT*` 是传递给命令的参数，以指明命令的操作对象。从中括号可以看出，`*ARGUMENT*` 也不是必需的，也可以一次指定多个 `*ARGUMENT*`

> **提示**
>
> 如果想使用多个命令选项，那么**通常可以将其合并在一起**。例如，要使用选项`-a`和`-b`，可以写作`-ab`。

不同命令的作者不同，用法也各异。因此，命令手册页中的概要部分是了解该命令正确语法的好地方。

> **提示**
>
> 如果不记得命令名了，可以使用关键字来搜索手册页。语法为`man -k *keyword*`。例如，要查找与终端相关的命令，可以入`man -k terminal`。

除了按照惯例命名的各段，手册页中还有不同的节。每节都分配了一个数字，从 1 开始，一直到 9，如表 3-2 所示。

**表3-2　Linux手册页的节**

| 节号 |       所涵盖的内容       |
| :--: | :----------------------: |
|  1   | 可执行程序或 shell 命令  |
|  2   |         系统调用         |
|  3   |          库调用          |
|  4   |         特殊文件         |
|  5   |      文件格式与约定      |
|  6   |           游戏           |
|  7   |     概览、约定及杂项     |
|  8   | 超级用户和系统管理员命令 |
|  9   |   内核例程（routine）    |

`man`命令通常显示的是指定命令编号最低的节。例如，我们之前输入的是`man hostname`，注意在显示内容的左上角和右上角，单词`HOSTNAME`后的圆括号中有一个数字：(`1`)。这表示所显示的手册页来自第 1 节（可执行程序或 shell 命令）。

> **注意**
>
> 你的 Linux 系统手册页可能包含一些非标准的节编号。例如，1p 对应于可移植操作系统接口（portable operating system interface，POSIX）命令，3n 对应于网络函数。

一个命令偶尔会在多个节中都有对应的手册页。例如，`hostname`命令的手册页既包括该命令的相关信息，也包括对系统主机名的概述。通常默认显示编号最低的节。就像 hostname 的手册页那样，自动显示就是`hostname`手册页的第 1 节。如果想查看特定节，可以输入`man *section# topicname*`。因此，输入`man 7 hostname`，可以查看手册页中的第 7 节。

也可以只看各节内容的简介，输入`man 1 intro`来阅读第 1 节，输入`man 2 intro`来阅读第 2 节，输入`man 3 intro`来阅读第 3 节，以此类推。

手册页并非唯一的参考资料。还有另一种称作 info 页面的信息。可以输入`info info`来了解 info 页面的相关内容。

内建命令（参见第 5 章）有自己的帮助页面。有关帮助页面的更多信息，可以输入`help help`。（看出这里面的门道没有？）

另外，大多数命令接受`-h`或`--help`选项。例如，可以输入`hostname -help`来查看简要的帮助信息。

显然有不少有用的资源可供参考。但是，很多基本的 shell 概念还是需要详细的解释。下一节会介绍如何浏览 Linux 文件系统。

## 4.浏览文件系统

当登录系统并获得 shell 命令提示符后，你通常位于自己的主目录中。一般情况下，除了主目录，你还想探索 Linux 系统中的其他领域。本节将告诉你如何使用 shell 命令来实现这个目标。在开始前，先了解一下 Linux 文件系统，为下一步做铺垫。

### 4.1 Linux文件系统

如果刚接触 Linux 系统，你可能弄不清楚 Linux 如何引用文件和目录，而对已经习惯于 Microsoft Windows 操作系统方式的人来说更是如此。在继续探索 Linux 系统之前，最好先了解一下 Linux 采用的方法。

你会发现，两者的第一处不同是，Linux 的路径中不使用驱动器盘符。在 Windows 中，计算机上安装的物理驱动器的分区决定了文件路径。Windows 会为每个物理磁盘分区分配一个盘符，每个分区都有自己的目录结构，用于访问存储在其中的文件。

举例来说，在 Windows 中，你经常会看到这样的文件路径：

```bash
C:\Users\Rich\Documents\test.doc
```

这种 Windows 文件路径表明了文件 test.doc 究竟位于哪个磁盘分区中。如果将 test.doc 保存在由 E 标识的闪存中，那么文件的路径就是 E:\test.doc，表明文件位于 E 盘的根目录。

Linux 则采用另一种方式。Linux 会将文件存储在名为**虚拟目录**（virtual directory）的单个目录结构中。虚拟目录会将计算机中所有存储设备的文件路径都纳入单个目录结构。

Linux 虚拟目录结构只包含一个称为**根**（root）目录的基础目录。根目录下的目录和文件会按照其访问路径一一列出，这点跟 Windows 类似。

> **提示**
>
> 你会注意到 Linux 使用正斜线（`/`）而不是反斜线（`\`）来分隔文件路径中的目录。反斜线在 Linux 中用作转义字符，如果误用在文件路径中会造成各种各样的问题。如果你之前用的是 Windows 环境，那么可能得花点儿时间来适应。

如图 3-2 所示，在 Linux 中你会看到下面这样的路径。

```bash
/home/rich/Documents/test.doc
```

这表明文件 test.doc 位于 Documents 目录，该目录位于 rich 目录，而 rich 目录则包含在 home 目录中。要注意的是，路径本身并没有提供任何有关文件究竟存放在哪个物理磁盘中的信息。

Linux 虚拟目录中比较复杂的部分是它如何来协调管理各个存储设备。我们称在 Linux 系统中安装的第一块硬盘为**根驱动器**。根驱动器包含了虚拟目录的核心，其他目录都是从那里开始构建的。

**图3-2 Linux虚拟目录文件路径**

<img src="img/020.jpg" alt="img" style="zoom: 67%;" />

Linux 会使用根驱动器上一些特别的目录作为**挂载点**（mount point）。挂载点是虚拟目录中分配给额外存储设备的目录。Linux 会让文件和目录出现在这些挂载点目录中，即便它们位于其他物理驱动器中。

系统文件通常存储在根驱动器中，而用户文件则存储在其他驱动器中，如图 3-3 所示。

**图3-3　Linux文件结构**

<img src="img/021.jpg" alt="img" style="zoom:80%;" />

图 3-3 展示了计算机中的两块硬盘。一块硬盘（Disk 1）与虚拟目录的根目录关联。其他硬盘可以挂载到虚拟目录结构中的任何地方。在这个例子中，另一块硬盘（Disk 2）被挂载到了 /home，这是用户主目录所在的位置。

Linux 文件系统结构演进自 Unix 文件系统。在 Linux 文件系统中，采用通用的目录名表示一些常见的功能。表 3-3 列出了一些常见的 Linux 顶层虚拟目录名及其内容。

**表3-3　常见的Linux目录名**

| 目录         | 用途                                                         |
| :----------- | :----------------------------------------------------------- |
| `/`          | 虚拟目录的根目录，通常不会在这里放置文件                     |
| `/bin`       | 二进制文件目录，存放了很多用户级的 GNU 实用工具              |
| `/boot`      | 引导目录，存放引导文件                                       |
| `/dev`       | 设备目录，Linux 在其中创建设备节点                           |
| `/etc`       | 系统配置文件目录                                             |
| `/home`      | 主目录，Linux 在其中创建用户目录（可选）                     |
| `/lib`       | 库目录，存放系统和应用程序的库文件                           |
| `/lib*name*` | 库目录，存放替代格式的系统和应用程序库文件（可选）           |
| `/media`     | 媒介目录，可移动存储设备的常用挂载点                         |
| `/mnt`       | 挂载目录，用于临时挂载文件系统的常用挂载点                   |
| `/opt`       | 可选目录，存放第三方软件包                                   |
| `/proc`      | 进程目录，存放现有内核、系统以及进程的相关信息               |
| `/root`      | root 用户的主目录（可选）                                    |
| `/run`       | 运行目录，存放系统的运行时数据                               |
| `/sbin`      | 系统二进制文件目录，存放了很多管理级的 GNU 实用工具          |
| `/srv`       | 服务目录，存放本地服务的相关文件                             |
| `/sys`       | 系统目录，存放设备、驱动程序以及部分内核特性信息             |
| `/tmp`       | 临时目录，可以在其中创建和删除临时工作文件                   |
| `/usr`       | 用户目录，一个次目录层级结构（secondary directory hierarchy） |
| `/var`       | 可变目录，存放经常变化的文件，比如日志文件                   |

在 CentOS Linux 系统中，根虚拟目录通常包含下列顶层目录：

```bash
bin   dev  home  lib64  mnt  proc  run   srv  tmp  var
boot  etc  lib   media  opt  root  sbin  sys  usr
```

/usr 目录值得特别关注，因为该目录是一个次目录层级结构，包含可共享的只读文件。你经常会在其中发现用户命令、源代码文件、游戏，等等。下面是 CentOS 系统中的 /usr 目录：

```bash
bin  games  include  lib  lib64  libexec  local  sbin  share  src  tmp
```

常见的 Linux 目录名均基于**文件系统层级标准**（filesystem hierarchy standard，FHS）。很多 Linux 发行版遵循了 FHS。这样一来，你就能够在任何兼容 FHS 的 Linux 系统中轻而易举地查找文件。

> **注意**
>
> FHS 偶尔会更新。你可能会发现有些 Linux 发行版仍在使用旧的 FHS 标准，而另一些发行版则只实现了部分当前标准。要想保持与 FHS 标准同步，请访问其官方主页。

当你登录系统并获得 shell CLI 提示符后，shell 会话会从你的主目录开始。主目录是分配给用户账户的一个特有目录。在创建用户账户时，系统通常会为其分配主目录（参见第 7 章）。

可以使用图形界面在虚拟目录中跳转。要想在 CLI 提示符下切换虚拟目录，需要使用`cd`命令。